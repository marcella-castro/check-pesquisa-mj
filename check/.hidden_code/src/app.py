"""
Aplica√ß√£o Dash para verifica√ß√£o de erros em pesquisa MJ
"""

import dash
from dash import html, dcc
from layouts.main_layout import create_main_layout
from callbacks.main_callbacks import register_callbacks
from utils.data_service import data_service

# Verificar configura√ß√µes antes de iniciar
try:
    from config.settings import Config
    missing_configs = Config.validate_config()
    if missing_configs:
        print("\n‚ö†Ô∏è  ATEN√á√ÉO: Configura√ß√µes ausentes!")
        print(f"   Vari√°veis de ambiente n√£o configuradas: {', '.join(missing_configs)}")
        print("   Configure estas vari√°veis no seu provedor de deploy ou arquivo .env")
        print("   A aplica√ß√£o funcionar√° em modo limitado.\n")
    config_available = Config.is_configured()
except Exception as e:
    print(f"‚ö†Ô∏è  Erro ao carregar configura√ß√µes: {e}")
    print("   A aplica√ß√£o funcionar√° em modo limitado.\n")
    config_available = False

# Inicializar a aplica√ß√£o Dash
app = dash.Dash(
    __name__,
    external_stylesheets=[
        'https://codepen.io/chriddyp/pen/bWLwgP.css',
        'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css'
    ],
    suppress_callback_exceptions=True,
    prevent_initial_callbacks=True  # Evita callbacks na inicializa√ß√£o
)

app.title = "Verificador de Pesquisa MJ"

# Iniciar carregamento dos dados em background apenas se configurado
if config_available:
    print("üöÄ Iniciando carregamento de dados em background...")
    data_service.start_background_loading()
else:
    print("‚ö†Ô∏è  API n√£o configurada - dados n√£o ser√£o carregados automaticamente")

# Definir o layout principal
app.layout = create_main_layout()

# Registrar callbacks
register_callbacks(app)

if __name__ == '__main__':
    app.run(debug=True, host='0.0.0.0', port=8050)
